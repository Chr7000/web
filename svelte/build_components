#!/bin/sh
set -euo pipefail

rm -rf static/svelte
mkdir -p static/svelte

yarn install --frozen-lockfile
yarn build

for f in dist/assets/*; do
	name=$(basename "$f")
	cp "$f" static/svelte/"$name"
done

{
	echo "{# Generated by build_components #}"
	echo "{% load static %}"
	grep -E '<(script|link)' dist/index.html | sed -E 's@\/assets\/([^"]+)@{% static "svelte/\1" %}@'
} > templates/svelte_include_generated.html
